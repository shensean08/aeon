<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<style type="text/css">

	html { height: 100% }
	body { height: 100%; margin: 0px; padding: 0px }

	.htmlButton{
		//margin-top:5px;
		font:14px "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, Osaka, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif; color: #333333;letter-spacing:0.1em;
		//font-size:16px;
		font-weight:bold;
		text-align:center;
	}

	.htmlHint{
		//margin-top:5px;
		font:14px "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, Osaka, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif; color: #000000;letter-spacing:0.1em;
		//font-size:16px;
		font-weight:bold;
		text-align:center;
		background-color:#000000;
	}

	.shelterImg{
		max-width: 180px;
		max-height: 120px;
	}

	.balloonClose{
		max-width: 30px;
		max-height: 30px;
	}

	.placeBalloonText {
		font:12px "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, Osaka, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif; color: #000000;letter-spacing:0.1em;
	}

</style>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type="text/javascript" src="https://maps.google.com/maps/api/js?libraries=places&sensor=true&language=ja"></script>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>

<script type="text/javascript" src="./js/globalConst.js"></script>
<script type="text/javascript" src="./js/globalVar.js"></script>

<script type="text/javascript" src="./js/keyboard.js"></script>
<script type="text/javascript" src="./js/download.js"></script>
<script type="text/javascript" src="./js/flyToOsaka.js"></script>
<script type="text/javascript" src="./js/getAddress.js"></script>
<script type="text/javascript" src="./js/global.js"></script>
<script type="text/javascript" src="./js/htmlButton.js"></script>
<script type="text/javascript" src="./js/htmlHint.js"></script>
<script type="text/javascript" src="./js/place.js"></script>
<script type="text/javascript" src="./js/placeBaloon.js"></script>
<script type="text/javascript" src="./js/placeSelectMenu.js"></script>
<script type="text/javascript" src="./js/qrcodeReader.js"></script>
<script type="text/javascript" src="./js/screenSave.js"></script>
<script type="text/javascript" src="./js/shelter.js"></script>
<script type="text/javascript" src="./js/sideMenu.js"></script>
<script type="text/javascript" src="./js/toggleKml.js"></script>
<script type="text/javascript" src="./js/userSession.js"></script>
<script type="text/javascript" src="./js/routeBtn.js"></script>

<script type="text/javascript">

//****************************************************************************/
// Main
// init google earth and google map
//****************************************************************************/

google.load("earth", "1");

// init
//
function init() {

	google.earth.createInstance('map3d', initCB, failureCB);
	map = new google.maps.Map(document.getElementById('map_canvas'), {
			mapTypeId: google.maps.MapTypeId.ROADMAP,
			center: new google.maps.LatLng(0,0),
			zoom: 13
		});
}

// initCB
//
function initCB(instance) {

	ge = instance;
	placeService = new google.maps.places.PlacesService(map);
	// Instantiate a directions service.
	directionsService = new google.maps.DirectionsService();
	// Create an ElevationService
	elevator = new google.maps.ElevationService();
	geocoder = new google.maps.Geocoder();
	ge.getWindow().setVisibility(true);
	ge.getLayerRoot().enableLayerById(ge.LAYER_BUILDINGS, true);
	ge.getLayerRoot().enableLayerById(ge.LAYER_BUILDINGS_LOW_RESOLUTION, true);
	Global.showfrontImage();
	Global.setLookAtInit();
	screenSave = new ScreenSave(SCREEN_SAVE_WAITTIME);	//[SCREEN_SAVE_WAITTIME]秒間何も触らないとスクリーンサーバーが起動
	screenSave.ready();
	QRcodeReader = new QRCodeReader();
	download = new Download();
	userSession = new UserSession();
	sideMenu = new SideMenu();
	routeButton = new RouteButton();
	loginHint = new HtmlHint("",0,0,SCREEN_WIDTH,SCREEN_HEIGHT);
	loginHint.setFontSize(42);
	loginHint.setBackgroundImage("coment-1.jpg");
	loginButton = new HtmlButton("登録",500,630,360,60);
	loginButton.setFontSize(28);
	appHint1 = new HtmlHint("",HINT_X,HINT_Y,SCREEN_WIDTH,SCREEN_HEIGHT);
	appHint1.setBackgroundImage("howto-1.png");
	appHint2 = new HtmlHint("",HINT_X,HINT_Y,SCREEN_WIDTH,SCREEN_HEIGHT);
	appHint2.setBackgroundImage("howto-2.png");

	//loginButton.show();
	cancelButton = new HtmlButton("キャンセル",500,(SCREEN_HEIGHT/2+25),360,60);
	cancelButton.setFontSize(20);
	flyToOsaka();
	sideMenu.show();

	loginButton.addClickListener(function() {
		loginButton.hide();
		loginHint.show();
		alert("login");

		QRcodeReader.read(function(){

			alert("this is callBack");

		});
		/*
		QRcodeReader.read(function(QRCode){
			userSession.requestUserInfo(QRCode,function() {
				alert("read callback");
				alert(QRCode);
				placeSelectMenu = new PlaceSelectMenu(userSession);
				loginHint.hide();
				Global.reset2Init();
				placeSelectMenu.show();
				sideMenu.show();
			});

		});
		*/
	});

	cancelButton.addClickListener(function() {
				cancelButton.hide();
				loginHint.hide();
				Global.reset2Init();
				//screenSave.start();
				userSession.loginOut();
				//sideMenu.show();
	});

	appHint1.hintDiv.addEventListener("click",function(evt){
		appHint1.hide();
		appHint2.show();
		screenSave.resetCount();
	});

	appHint2.hintDiv.addEventListener("click", function(evt){
		appHint2.hide();
		screenSave.resetCount();
	});



	loginHint.hintDiv.addEventListener("click",function(evt){
		//alert("click1");
		userSession.loginOut();
		loginHint.hide();
		Global.reset2Init();
		flyToOsaka();
		QRcodeReader.stopRead();
		//screenSave.start();
		//alert("end");
	});

/*
	videoObj = document.getElementById("screenSaveVideo");
	videoObj.width = 1915;
	videoObj.height = 1075;
	videoObj.src="video/screen2.mp4"
*/


	/////////////
	google.earth.addEventListener(ge.getView(), "viewchange", viewEventListener);
	////////////
	//keyboardFocusHack(ge);

}

function failureCB(errorCode) {}

google.setOnLoadCallback(init);

//////定期的にページを更新、UserSessionじゃない時のみ
/////できれば次回ログアウト時にページを更新したい
function reloadPage(){
	if(!userSession.isLoginIn()){
		location.reload();
	}
}

///シェルターなど開放できていないときがある
///現在地の開放ができていないことがある


///世界旅行防止したい
///カメラ標高一定以上で操作不能
///カメラ見てる座標一定以上で操作不能（スクリーンセーバー？）
///画像の読み込みを最初に
///
///クラッシュが多いのでとりあえず中止
///onLoad="setInterval('reloadPage()',1000*60*30)"

</script>

</head>
<body>
	<div style="height:0px; width:0px;">
      <applet ID='DownloadApplet' Name = 'DownloadApplet' codebase='.'
    	code='DownloadApplet.class' archive='DownloadApplet.jar'
    	width='0' height='0'>
      </applet>
    </div>
    <div id="map3d" style="height:1080px; width:1920px; cursor:crosshair;"></div>
    <div id="map_canvas" style="height:0px; width:0px;"></div>
	<div style="position:absolute; left:0px;top:0px; cursor:crosshair";>
	</div>

<!--
<p><input type="button" value="getAddress" onclick="getAddress(viewLat,viewLng)">
<input type="button" value="qrDebug" onclick="qrDebug();">
<input type="button" value="hint" onclick="applicationHint();">
<input type="button" value="route" onclick="shelterRoute1()"></p>
-->
</body>
</html>
